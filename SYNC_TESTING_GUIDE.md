# 多设备同步测试指南

本指南将帮助您测试CloudKit多设备同步功能，确保数据在不同设备间正确同步。

## 测试前准备

### 1. 环境要求
- 至少2台iOS设备（iPhone/iPad）
- 两台设备都登录相同的iCloud账号
- 两台设备都有稳定的网络连接
- 应用已正确配置CloudKit功能

### 2. 检查iCloud设置
1. 在两台设备上打开"设置" → "Apple ID" → "iCloud"
2. 确保"iCloud Drive"已开启
3. 确保应用有iCloud权限

## 基础同步测试

### 测试1：任务创建同步
**目标**：验证在一台设备上创建的任务能同步到另一台设备

**步骤**：
1. 在设备A上打开应用
2. 创建一个新任务：
   - 标题："测试任务1"
   - 描述："这是一个同步测试任务"
   - 分类："学习"
   - 截止时间：明天下午3点
3. 保存任务
4. 观察同步状态栏，等待显示"同步成功"
5. 在设备B上打开应用
6. 检查任务列表中是否出现"测试任务1"

**预期结果**：设备B应该能看到新创建的任务

### 测试2：任务修改同步
**目标**：验证任务修改能正确同步

**步骤**：
1. 在设备B上找到"测试任务1"
2. 点击编辑，修改标题为"测试任务1-已修改"
3. 修改描述为"这是修改后的描述"
4. 保存修改
5. 等待同步完成
6. 在设备A上刷新或重新打开应用
7. 检查任务是否显示修改后的内容

**预期结果**：设备A应该显示修改后的任务内容

### 测试3：任务完成状态同步
**目标**：验证任务完成状态能正确同步

**步骤**：
1. 在设备A上找到"测试任务1-已修改"
2. 点击任务前的圆圈，标记为完成
3. 等待同步完成
4. 在设备B上检查任务状态

**预期结果**：设备B上的任务应该显示为已完成状态

### 测试4：任务删除同步
**目标**：验证删除操作能正确同步

**步骤**：
1. 在设备B上删除"测试任务1-已修改"
2. 等待同步完成
3. 在设备A上检查任务是否消失

**预期结果**：设备A上的任务应该被删除

## 高级同步测试

### 测试5：冲突解决测试
**目标**：验证同时修改同一任务时的冲突解决

**步骤**：
1. 在两台设备上都断开网络
2. 在设备A上创建任务"冲突测试"
3. 在设备B上也创建任务"冲突测试"（相同标题）
4. 恢复两台设备的网络连接
5. 等待同步完成
6. 检查两台设备上的任务列表

**预期结果**：应该有两个不同的任务，或者根据时间戳保留最新的

### 测试6：网络中断恢复测试
**目标**：验证网络中断后恢复时的同步行为

**步骤**：
1. 在设备A上断开网络
2. 创建多个任务
3. 修改现有任务
4. 恢复网络连接
5. 观察同步状态和进度
6. 在设备B上验证所有更改

**预期结果**：网络恢复后应该自动同步所有离线更改

### 测试7：大量数据同步测试
**目标**：验证大量数据的同步性能

**步骤**：
1. 在设备A上创建20个任务
2. 设置不同的分类、优先级和截止时间
3. 等待全部同步完成
4. 在设备B上验证所有任务

**预期结果**：所有任务都应该正确同步，数据完整

## 番茄工作法同步测试

### 测试8：番茄工作法记录同步
**目标**：验证番茄工作法会话记录能正确同步

**步骤**：
1. 在设备A上启动番茄工作法
2. 完成一个完整的工作周期
3. 等待同步完成
4. 在设备B上检查番茄工作法历史记录

**预期结果**：设备B应该显示相同的番茄工作法记录

## 同步状态监控测试

### 测试9：同步状态显示测试
**目标**：验证同步状态UI的正确性

**步骤**：
1. 观察应用顶部的同步状态栏
2. 创建新任务时观察状态变化
3. 断开网络时观察状态变化
4. 恢复网络时观察状态变化

**预期结果**：
- 同步中：显示旋转图标
- 同步成功：显示绿色云图标
- 网络断开：显示红色WiFi图标
- 同步失败：显示红色警告图标

### 测试10：手动同步测试
**目标**：验证手动同步功能

**步骤**：
1. 在设置页面点击"立即同步"
2. 观察同步状态变化
3. 验证数据是否更新

**预期结果**：手动同步应该立即触发数据同步

## 故障排除测试

### 测试11：iCloud账号切换测试
**目标**：验证切换iCloud账号时的行为

**步骤**：
1. 在设备A上登出iCloud账号
2. 登录不同的iCloud账号
3. 观察应用行为
4. 重新登录原账号

**预期结果**：应用应该正确处理账号切换，不会崩溃

### 测试12：应用重启测试
**目标**：验证应用重启后的同步行为

**步骤**：
1. 在设备A上创建任务
2. 强制关闭应用
3. 重新打开应用
4. 观察同步状态和数据

**预期结果**：应用重启后应该自动同步数据

## 测试结果记录

### 测试记录表格

| 测试项目 | 设备A结果 | 设备B结果 | 同步时间 | 状态 | 备注 |
|---------|----------|----------|---------|------|------|
| 任务创建同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 任务修改同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 任务完成同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 任务删除同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 冲突解决 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 网络恢复同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 大量数据同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 番茄记录同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |
| 同步状态显示 | ✅/❌ | ✅/❌ | - | 通过/失败 | |
| 手动同步 | ✅/❌ | ✅/❌ | __秒 | 通过/失败 | |

### 常见问题及解决方案

1. **同步很慢或失败**
   - 检查网络连接
   - 确认iCloud账号状态
   - 重启应用

2. **数据不一致**
   - 检查时间戳
   - 验证冲突解决逻辑
   - 查看CloudKit Console

3. **同步状态不更新**
   - 检查UI更新逻辑
   - 验证网络监控功能

## 测试完成标准

所有测试项目都应该：
- ✅ 功能正常工作
- ✅ 同步时间在合理范围内（通常<30秒）
- ✅ 数据完整性保持
- ✅ 用户界面响应正常
- ✅ 无应用崩溃或严重错误

完成所有测试后，您的多设备同步功能就可以正式使用了！
